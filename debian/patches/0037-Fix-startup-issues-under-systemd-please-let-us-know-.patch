From 9739ec9b0515726c932d9a7da128355a86450eac Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Mon, 12 Sep 2016 18:52:05 +0000
Subject: [PATCH 37/50] Fix startup issues under systemd (please let us know if
 this breaks other contexts)

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14560 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 src/main.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/main.c b/src/main.c
index 06e3777..07b3d43 100644
--- a/src/main.c
+++ b/src/main.c
@@ -969,7 +969,11 @@ void Daemonize( const char* pidfile )
  int i;
 
     /* detach from our parent if necessary */
-    if (! (getppid() == 1) && ( ! PC_Struct.foreground_mode ) )
+    // NOTE: When started under systemd, the parent PID is already 1, so
+    //       the safety check below of the parent PID causes imap_proxy
+    //       to start in foreground mode. I'm commenting it out, hoping
+    //       it doesn't cause issues in other contexts
+    if (/*! (getppid() == 1) &&*/ ( ! PC_Struct.foreground_mode ) )
     {
 	syslog( LOG_INFO, "%s: Configured to run in background mode.", fn );
 
-- 
2.7.4

