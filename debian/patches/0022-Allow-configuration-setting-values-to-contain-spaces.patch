From 311a709c49790a4e703f09928d4d88bdb2b398ac Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Sun, 8 May 2011 07:57:09 +0000
Subject: [PATCH 22/50] Allow configuration setting values to contain spaces

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14112 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 src/config.c | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git a/src/config.c b/src/config.c
index 848142a..72bb8a7 100644
--- a/src/config.c
+++ b/src/config.c
@@ -393,6 +393,9 @@ extern void SetConfigOptions( char *ConfigFile )
     ADD_TO_TABLE( "cache_expiration_time", SetNumericValue, 
 		  &PC_Struct.cache_expiration_time, index );
 
+    ADD_TO_TABLE( "preauth_command", SetStringValue,
+		  &PC_Struct.preauth_command, index );
+
     ADD_TO_TABLE( "auth_sasl_plain_username", SetStringValue,
 		  &PC_Struct.auth_sasl_plain_username, index );
     
@@ -505,6 +508,24 @@ extern void SetConfigOptions( char *ConfigFile )
 	}
 	
 	Value = CP;
+
+	// we don't just want the next token, we want the rest of the line
+	// (put back the space that strtok() changed into a null character)
+	//
+	Value[ strlen( Value ) ] = ' ';
+
+	// however, we then have to be careful to remove trailing whitespace
+	//
+	i = strlen( Value ) - 1;
+	while ( ( Value[ i ] == ' ' )
+	     || ( Value[ i ] == '\t' )
+	     || ( Value[ i ] == '\r' )
+	     || ( Value[ i ] == '\n' ) )
+	{
+	    i--;
+	}
+	if ( i < ( strlen( Value ) - 1 ) )
+	    Value[ i + 1 ] = '\0';
 	
 	for (i = 0; ConfigTable[i].Keyword[0] != '\0'; i++ )
 	{
-- 
2.7.4

