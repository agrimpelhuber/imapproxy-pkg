From 819917a9d6690d80585a5fbd62a8d33826f77616 Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Fri, 16 Dec 2011 17:53:04 +0000
Subject: [PATCH 26/50] Makefile cleanup and header include fix for OpenBSD,
 both complements Brad Smith

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14233 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 ChangeLog   | 4 ++++
 Makefile.in | 9 +++++----
 config.h.in | 4 ++++
 3 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index 6c0ed95..4b6b2b8 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,7 @@
+2011-12-16  Paul Lesniewski <paul@squirrelmail.org>
+	* Minor Makefile cleanup complements Brad Smith
+	* Fixed header include issue for OpenBSD (thanks to Brad Smith)
+
 2011-11-23  Paul Lesniewski <paul@squirrelmail.org>
 	* Added DESTDIR support to install scripts (thanks to Brad Smith)
 
diff --git a/Makefile.in b/Makefile.in
index d4ee137..abdac2d 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -4,7 +4,7 @@
 # Fixed to work with configure script
 # by Devrim SERAL <devrim@gazi.edu.tr>
 
-# Cleaned up by Ken Murchison
+# Cleaned up by Ken Murchison, Brad Smith
 
 ## Tuneables
 
@@ -23,11 +23,12 @@ libdir = $(prefix)/lib/gnudl
 mandir = $(prefix)/man/man3
 
 CC = @CC@
-CPPFLAGS = @CPPFLAGS@ 
+CPPFLAGS = @CPPFLAGS@
+CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 DEFINES = @DEFINES@
-FLAGS = $(CPPFLAGS) @CFLAGS@ -I. -I./include
+FLAGS = -I. -I./include
 
 INSTALL = @INSTALL@
 EBIN = $(sbindir)
@@ -63,7 +64,7 @@ all: $(XYD_BIN) $(TAT_BIN)
 $(XYD_OBJ) $(TAT_OBJ): $(MAKEFILE) ./include/common.h ./include/imapproxy.h
 
 .c.o:
-	$(CC) $(CFLAGS) $(FLAGS) -c -o $@ $<
+	$(CC) $(CFLAGS) $(FLAGS) $(CPPFLAGS) -c -o $@ $<
 
 $(XYD_BIN): $(XYD_OBJ)
 	$(CC) -o $@ $(XYD_OBJ) $(LDFLAGS) $(XYD_LIB)
diff --git a/config.h.in b/config.h.in
index 062a90b..87b7576 100644
--- a/config.h.in
+++ b/config.h.in
@@ -89,6 +89,10 @@
 /* Define to empty if `const' does not conform to ANSI C. */
 #undef const
 
+#if HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+
 #if HAVE_SYS_MMAN_H
 #include <sys/mman.h>
 #endif
-- 
2.7.4

