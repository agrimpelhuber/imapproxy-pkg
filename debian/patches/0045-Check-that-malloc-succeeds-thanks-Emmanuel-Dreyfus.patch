From 78fd93aa8e34de885752c136c9d1cc5866c1bf09 Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Wed, 14 Sep 2016 01:30:38 +0000
Subject: [PATCH 45/50] Check that malloc succeeds (thanks Emmanuel Dreyfus)

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14568 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 src/imapcommon.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/imapcommon.c b/src/imapcommon.c
index 8dfc06c..ee7701b 100644
--- a/src/imapcommon.c
+++ b/src/imapcommon.c
@@ -694,6 +694,11 @@ extern ICD_Struct *Get_Server_conn( char *Username,
      * Open a connection to the IMAP server so we can attempt to login 
      */
     Server.conn = ( ICD_Struct * ) malloc( sizeof ( ICD_Struct ) );
+    if (Server.conn == NULL) {
+	syslog( LOG_ERR, "%s: malloc() failed: %s -- Exiting.", __func__,
+		strerror( errno ) );
+	exit( 1 );
+    }
     memset( Server.conn, 0, sizeof ( ICD_Struct ) );
 
     /* As a new connection, the ICD is not 'reused' */
-- 
2.7.4

