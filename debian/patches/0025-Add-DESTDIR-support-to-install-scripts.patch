From 56896a7f1ad7b13096b6e24a31841433efece16f Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Wed, 23 Nov 2011 20:53:38 +0000
Subject: [PATCH 25/50] Add DESTDIR support to install scripts

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14153 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 ChangeLog      |  4 ++++
 Makefile.in    | 21 ++++++++++-----------
 imapproxy.spec |  2 +-
 3 files changed, 15 insertions(+), 12 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index 8c41d34..6c0ed95 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,6 @@
+2011-11-23  Paul Lesniewski <paul@squirrelmail.org>
+	* Added DESTDIR support to install scripts (thanks to Brad Smith)
+
 2011-11-09  Paul Lesniewski <paul@squirrelmail.org>
 	* Fixed minor bug where too many spaces were added before
           XIMAPPROXY in the CAPABILITY string (thanks to Kirill Miazine)
@@ -11,6 +14,7 @@
 
 2011-04-17  Paul Lesniewski <paul@squirrelmail.org>
 	* Add restart operation to (linux) init script
+
 	* Add BSD-style init script (thanks to Emmanuel Dreyfus)
 
 2011-04-17  Paul Lesniewski <paul@squirrelmail.org>
diff --git a/Makefile.in b/Makefile.in
index 0d42ac8..d4ee137 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -21,7 +21,6 @@ sbindir = $(exec_prefix)/sbin
 infodir = $(prefix)/info
 libdir = $(prefix)/lib/gnudl
 mandir = $(prefix)/man/man3
-rpm_prefix = @rpm_prefix@
 
 CC = @CC@
 CPPFLAGS = @CPPFLAGS@ 
@@ -79,21 +78,21 @@ distclean: clean
 	rm -f config.cache config.log config.h Makefile
 
 install: $(XYD_BIN) $(TAT_BIN)
-	mkdir -p $(EBIN)
-	$(INSTALL) -o bin -g bin -m 0755 $(XYD_BIN) $(EBIN)
-	$(INSTALL) -o bin -g bin -m 0755 $(TAT_BIN) $(EBIN)
+	mkdir -p $(DESTDIR)$(EBIN)
+	$(INSTALL) -o bin -g bin -m 0755 $(XYD_BIN) $(DESTDIR)$(EBIN)
+	$(INSTALL) -o bin -g bin -m 0755 $(TAT_BIN) $(DESTDIR)$(EBIN)
 
 install-init-linux:
-	$(INSTALL) -o root -g sys -m 0755 ./scripts/imapproxy-linux.init $(ETC)/init.d/imapproxy
-	ln -s ../init.d/imapproxy /etc/rc2.d/S99imapproxy
-	ln -s ../init.d/imapproxy /etc/rc0.d/K10imapproxy
+	$(INSTALL) -o root -g sys -m 0755 ./scripts/imapproxy-linux.init $(DESTDIR)$(ETC)/init.d/imapproxy
+	ln -s ../init.d/imapproxy $(DESTDIR)/etc/rc2.d/S99imapproxy
+	ln -s ../init.d/imapproxy $(DESTDIR)/etc/rc0.d/K10imapproxy
 
 install-conf:
-	$(INSTALL) -o root -g bin -m 0644 ./scripts/imapproxy.conf $(ETC)
+	$(INSTALL) -o root -g bin -m 0644 ./scripts/imapproxy.conf $(DESTDIR)$(ETC)
 
-rpm-install: install 
-	$(INSTALL) -o root -g sys -m 0644 ./scripts/imapproxy.conf $(rpm_prefix)/etc
-	$(INSTALL) -o root -g sys -m 0755 ./scripts/imapproxy-linux.init $(rpm_prefix)/etc/init.d/imapproxy
+rpm-install: install
+	$(INSTALL) -o root -g sys -m 0644 ./scripts/imapproxy.conf $(DESTDIR)/etc
+	$(INSTALL) -o root -g sys -m 0755 ./scripts/imapproxy-linux.init $(DESTDIR)/etc/init.d/imapproxy
 
 pkg:
 	pkgmk -o -r .
diff --git a/imapproxy.spec b/imapproxy.spec
index 5d4ebdc..ff18554 100644
--- a/imapproxy.spec
+++ b/imapproxy.spec
@@ -50,7 +50,7 @@ install -d $RPM_BUILD_ROOT/etc
 install -d $RPM_BUILD_ROOT/etc/init.d
 install -d $RPM_BUILD_ROOT/%{prefix}/sbin
 
-make prefix=$RPM_BUILD_ROOT%{prefix} rpm_prefix=$RPM_BUILD_ROOT  rpm-install
+make DESTDIR=$RPM_BUILD_ROOT rpm-install
 
 %clean
 rm -rf $RPM_BUILD_ROOT
-- 
2.7.4

