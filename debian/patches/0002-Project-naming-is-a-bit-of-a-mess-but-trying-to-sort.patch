From 1cb9512dc4a807ed813eae993a95d01f438f71bf Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Mon, 26 Jul 2010 21:03:03 +0000
Subject: [PATCH 02/50] Project naming is a bit of a mess, but trying to sort
 it out

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14046 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 README                 | 40 +++++++++++++++++++++-------------------
 README.debian          | 30 +++++++++++++++---------------
 README.known_issues    |  4 ++--
 README.ssl             | 10 +++++-----
 imapproxy.spec         |  4 ++--
 pkginfo                |  2 +-
 prototype              |  6 +++---
 scripts/imapproxy.conf | 29 +++++++++++++++--------------
 scripts/imapproxy.init |  2 +-
 src/main.c             |  8 ++++----
 src/request.c          |  4 ++--
 src/select.c           |  2 +-
 src/threads.c          |  2 +-
 13 files changed, 73 insertions(+), 70 deletions(-)

diff --git a/README b/README
index c187da6..9076ab2 100644
--- a/README
+++ b/README
@@ -4,7 +4,7 @@
 
 This directory contains the source distribution of SquirrelMail IMAP Proxy.
 
-If you find any bugs in squirrelmail-imapproxy, please subscribe to the
+If you find any bugs in squirrelmail-imap_proxy, please subscribe to the
 squirrelmail-imapproxy mailing list and post your bug there.
 
 If you want to subscribe to the squirrelmail-imapproxy mailing list, visit:
@@ -13,15 +13,16 @@ https://lists.sourceforge.net/lists/listinfo/squirrelmail-imapproxy
 
 For some Debian specific issues that have come up, read the file README.debian.
 
-To read a little bit about SSL support in imapproxy, read README.ssl.
+To read a little bit about SSL support in squirrelmail-imap_proxy, read
+README.ssl.
 
 
 ##############################################################################
 HOW TO BUILD
 ##############################################################################
 
-Before you build imapproxy, you're going to need to obtain the OpenSSL
-libraries.  Build and install them, then you're ready to move on.
+Before you build squirrelmail-imap_proxy, you're going to need to obtain
+the OpenSSL libraries.  Build and install them, then you're ready to move on.
 
 It should be pretty painless:
 
@@ -154,8 +155,9 @@ See README.ssl for more information.
 
 tls_cert_file
 -------------
-File containing the certificate presented by imapproxy to the server for
-client authentication during STARTTLS.  See README.ssl for more information.
+File containing the certificate presented by squirrelmail-imap_proxy to the
+server for client authentication during STARTTLS.  See README.ssl for more
+information.
 
 tls_key_file
 ------------
@@ -168,19 +170,19 @@ Allows SELECT data caching to be enabled or disabled.
 
 foreground_mode
 ---------------
-When enabled, this will prevent imapproxy from detaching from his parent
-process and controlling terminal.
+When enabled, this will prevent squirrelmail-imap_proxy from detaching from
+his parent process and controlling terminal.
 
 chroot_directory
 ----------------
-If this value is set to anything, it implicitly causes imapproxy to run in
-a chroot jail.
+If this value is set to anything, it implicitly causes squirrelmail-imap_proxy
+to run in a chroot jail.
 
 enable_admin_commands
 ---------------------
-The internal admin commands that imapproxy provides (p_dumpicc, p_trace,
-etc) are a security vulnerability if you do not restrict access to the
-listen_port using tcp wrappers, iptables, ipchains, ipfilter, an external
+The internal admin commands that squirrelmail-imap_proxy provides (p_dumpicc,
+p_trace, etc) are a security vulnerability if you do not restrict access to
+the listen_port using tcp wrappers, iptables, ipchains, ipfilter, an external
 firewall, or some other mechanism.  Because of this, the internal admin
 commands are disabled by default.
 
@@ -189,10 +191,10 @@ commands are disabled by default.
 NEW STATUS RESPONSE:
 ##############################################################################
 
-Upon a successful LOGIN or AUTHENTICATION, if imapproxy reused an existing
-connection an untagged IMAP response with the status response XPROXYREUSE
-will be issued.  This status response indicates to a client that any previous
-initialization does not need to be performed again.
+Upon a successful LOGIN or AUTHENTICATION, if squirrelmail-imap_proxy reused
+an existing connection an untagged IMAP response with the status response
+XPROXYREUSE will be issued.  This status response indicates to a client that
+any previous initialization does not need to be performed again.
 
 Examples:
 ---------
@@ -206,7 +208,7 @@ S: a001 OK User logged in
 
 C: a001 LOGIN user password
 S: [... untagged response(s) from remote IMAP server ...]
-S: * OK [XPROXYREUSE] IMAP connection reused by imapproxy
+S: * OK [XPROXYREUSE] IMAP connection reused by squirrelmail-imap_proxy
 S: a001 OK User logged in
 
 
@@ -316,7 +318,7 @@ Usage:
 Untagged response(s) (1 for each cached connection):
   * XPROXY_VERSION <version>
 
-  <version> = Current version number of imapproxy.
+  <version> = Current version number of squirrelmail-imap_proxy.
 
 Example:
 C: a001 XPROXY_VERSION
diff --git a/README.debian b/README.debian
index 781a09b..682f56c 100644
--- a/README.debian
+++ b/README.debian
@@ -1,22 +1,22 @@
 Michael Faurot <mfaurot at atww.org> submitted some helpful information
-for people building and installing squirrelmail-imapproxy on Debian Linux
+for people building and installing squirrelmail-imap_proxy on Debian Linux
 systems.  I've included his information here, exactly as he submitted it.
 
 It's now worth noting that there's an official Debian package for
-squirrelmail-imapproxy (courtesy of Jose Luis Tallon) so you might
+squirrelmail-imap_proxy (courtesy of Jose Luis Tallon) so you might
 want to save yourself some time and effort and just apt-get that.
 
 
 o)	On a Debian system that uses UW IMAP you'll need to rename
 	/etc/rc2.d/S99rmnologin to something like S98rmnologin.  Then be
-	sure the rc script for imapproxy is run as S99imapproxy.
-	This insures that when imapproxy goes to query the imap
-	daemon, the IMAP daemon will actually say it's ready.  UW IMAP
-	respects the /etc/nologin file, and if imapproxy queries while
-	/etc/nologin is still present, imapproxy will fail to start.
-	Debian creates /etc/nologin during the early stages of bootup,
-	to prevent premature logins, and then removes it in the last
-	stages of going multiuser.
+	sure the rc script for squirrelmail-imap_proxy is run as
+        S99imapproxy.  This insures that when squirrelmail-imap_proxy goes
+        to query the imap daemon, the IMAP daemon will actually say it's
+        ready.  UW IMAP respects the /etc/nologin file, and if
+        squirrelmail-imap_proxy queries while /etc/nologin is still present,
+        squirrelmail-imap_proxy will fail to start.  Debian creates
+        /etc/nologin during the early stages of bootup, to prevent premature
+        logins, and then removes it in the last stages of going multiuser.
 
 
 o)	Add a PATH statement close to the top of the rc script
@@ -38,11 +38,11 @@ o)	If building against locally created OpenSSL libraries that
 		export CFLAGS LIBS
 
 
-o)	I built my installation of imapproxy  against my own locally 
-	compiled copies of OpenSSL's static libraries on a Debian stable
-	system.  It appears, from some messages that were on the
-	mailing list, that people attempting to build imapproxy using
-	the stock Debian OpenSSL libraries may not realize they also
+o)	I built my installation of squirrelmail-imap_proxy  against my own
+        locally compiled copies of OpenSSL's static libraries on a Debian
+        stable system.  It appears, from some messages that were on the
+	mailing list, that people attempting to build squirrelmail-imap_proxy
+        using the stock Debian OpenSSL libraries may not realize they also
 	need to install the development package for OpenSSL to get its
 	headers and libraries.  That can be done like this:
 
diff --git a/README.known_issues b/README.known_issues
index 3e76ebd..1a270bc 100644
--- a/README.known_issues
+++ b/README.known_issues
@@ -1,6 +1,6 @@
 README was starting to become too cluttered, so I split out a few known
 issues that you may encounter and stuck them in this file.  If you already
-built squirrelmail-imapproxy and didn't encounter any problems, you probably
+built squirrelmail-imap_proxy and didn't encounter any problems, you probably
 don't need to read any further.
 
 -------------------------------------------------------------------------------
@@ -74,5 +74,5 @@ Problem: Attempting to build rpm on RedHat 9 or RedHat Enterprise Linux 3 fails
 
 Symptom:  
 
-Fix:     rpmbuild -tb squirrelmail-imapproxy-1.2.3.tar.gz --define 'with_krb5 1'
+Fix:     rpmbuild -tb squirrelmail-imap_proxy-1.2.3.tar.gz --define 'with_krb5 1'
 -------------------------------------------------------------------------------
diff --git a/README.ssl b/README.ssl
index a3cac2c..7497c2f 100644
--- a/README.ssl
+++ b/README.ssl
@@ -1,7 +1,7 @@
-First, if you're using squirrelmail-imapproxy with SSL, you have Ken
+First, if you're using squirrelmail-imap_proxy with SSL, you have Ken
 Murchison to thank for that.  He added this feature.
 
-squirrelmail-imapproxy only supports TLS between the proxy server and the
+squirrelmail-imap_proxy only supports TLS between the proxy server and the
 real IMAP server.  It does not support TLS between a client (usually webmail)
 and the proxy server.  The idea here is that you can run the IMAP proxy on
 the same machine as your webserver.  If you're using TLS to your webserver,
@@ -11,9 +11,9 @@ ever crossing the network, then the proxy can use TLS to the IMAP server.
 The proxy will only use TLS if the real IMAP server forces it to do so by
 advertising LOGINDISABLED in the capability string.
 
-imapproxy does not support the deprecated notion of imaps using port 993.
-It only supports the use of the STARTTLS command to initiate SSL/TLS from
-within a regular IMAP connection.
+squirrelmail-imap_proxy does not support the deprecated notion of imaps
+using port 993.  It only supports the use of the STARTTLS command to
+initiate SSL/TLS from within a regular IMAP connection.
 
 There are four configuration file options that you'll have to set in order
 for SSL to work.  They are tls_ca_file, tls_ca_path, tls_cert_file and
diff --git a/imapproxy.spec b/imapproxy.spec
index 9c2293e..5d4ebdc 100644
--- a/imapproxy.spec
+++ b/imapproxy.spec
@@ -1,4 +1,4 @@
-#This is imapproxy rpm spec file
+#This is squirrelmail-imap_proxy rpm spec file
 
 %define ver	1.2.7
 %define rel	1
@@ -6,7 +6,7 @@
 
 %define withkrb5 0
 # Check for option at command line, ie:
-# rpmbuild -bb imapproxy.spec --define 'with_krb5 1'
+# rpmbuild -bb squirrelmail-imap_proxy.spec --define 'with_krb5 1'
 # with_krb5 indicates the Kerberos includes are needed (ie: Red Hat Linux 9)
 %{?with_krb5:%define withkrb5 1}
 
diff --git a/pkginfo b/pkginfo
index c527bfd..2683be6 100644
--- a/pkginfo
+++ b/pkginfo
@@ -1,4 +1,4 @@
-PKG=imapproxy
+PKG=squirrelmail-imap_proxy
 NAME=SquirrelMail IMAP Proxy
 ARCH=sparc
 VERSION=1.2.7
diff --git a/prototype b/prototype
index 2a06f18..6feab39 100644
--- a/prototype
+++ b/prototype
@@ -8,9 +8,9 @@ l none /etc/rc2.d/K10imapproxy=/etc/init.d/imapproxy
 l none /etc/rc3.d/S99imapproxy=/etc/init.d/imapproxy
 l none /etc/rcS.d/K10imapproxy=/etc/init.d/imapproxy
 d none doc 0755 root sys
-d none doc/squirrelmail-imapproxy 0755 root sys
-f none doc/squirrelmail-imapproxy/ChangeLog=ChangeLog 0644 root sys
-f none doc/squirrelmail-imapproxy/README=README 0644 root sys
+d none doc/squirrelmail-imap_proxy 0755 root sys
+f none doc/squirrelmail-imap_proxy/ChangeLog=ChangeLog 0644 root sys
+f none doc/squirrelmail-imap_proxy/README=README 0644 root sys
 d none sbin 0755 root sys
 f none sbin/in.imapproxyd=bin/in.imapproxyd 0755 root sys
 f none sbin/pimpstat=bin/pimpstat 0755 root sys
diff --git a/scripts/imapproxy.conf b/scripts/imapproxy.conf
index 5ce1fad..cfd20cd 100644
--- a/scripts/imapproxy.conf
+++ b/scripts/imapproxy.conf
@@ -120,11 +120,11 @@ syslog_facility LOG_MAIL
 ## syslog_prioritymask
 ##
 ## This configuration option is provided as a way to limit the verbosity
-## of imapproxy.  If no value is specified, it will default to no priority
-## mask and you'll see all possible log messages.  Any of the possible
-## priority values listed in the syslog(3C) manpage may be used here.
-## By default, I've left this commented out so you will see all possible
-## log messages.
+## of squirrelmail-imap_proxy.  If no value is specified, it will default
+## to no priority mask and you'll see all possible log messages.  Any of
+## the possible priority values listed in the syslog(3C) manpage may be
+## used here.  By default, I've left this commented out so you will see
+## all possible log messages.
 #
 #syslog_prioritymask LOG_WARNING
 
@@ -142,7 +142,7 @@ send_tcp_keepalives no
 ## enable_select_cache
 ##
 ## This configuration option allows you to turn select caching on or off.
-## When select caching is enabled, squirrelmail-imapproxy will cache SELECT
+## When select caching is enabled, squirrelmail-imap_proxy will cache SELECT
 ## responses from an IMAP server.
 #
 enable_select_cache no
@@ -151,8 +151,8 @@ enable_select_cache no
 #
 ## foreground_mode
 ##
-## This will prevent imapproxy from detaching from his parent process and
-## controlling terminal on startup.
+## This will prevent squirrelmail-imap_proxy from detaching from his parent
+## process and controlling terminal on startup.
 #
 foreground_mode no
 
@@ -160,7 +160,7 @@ foreground_mode no
 #
 ## force_tls
 ##
-## Force imapproxy to use STARTTLS even if LOGIN is not disabled.
+## Force squirrelmail-imap_proxy to use STARTTLS even if LOGIN is not disabled.
 #
 force_tls no
 
@@ -168,10 +168,10 @@ force_tls no
 #
 ## chroot_directory
 ##
-## This allows imapproxy to run in a chroot jail if desired.
-## If commented out, imapproxy will not run chroot()ed.  If
-## a directory is specified here, imapproxy will chroot() to that
-## directory.
+## This allows squirrelmail-imap_proxy to run in a chroot jail if desired.
+## If commented out, squirrelmail-imap_proxy will not run chroot()ed.  If
+## a directory is specified here, squirrelmail-imap_proxy will chroot() to
+## that directory.
 #
 #chroot_directory /var/empty
 
@@ -179,7 +179,8 @@ force_tls no
 #
 ## enable_admin_commands
 ##
-## Used to enable or disable the internal imapproxy administrative commands.
+## Used to enable or disable the internal squirrelmail-imap_proxy
+## administrative commands.
 #
 enable_admin_commands no
 
diff --git a/scripts/imapproxy.init b/scripts/imapproxy.init
index 7a39d35..9e1ce86 100755
--- a/scripts/imapproxy.init
+++ b/scripts/imapproxy.init
@@ -35,7 +35,7 @@
 ##      Initial revision
 ##
 ##
-# Init file for imapproxy server daemon
+# Init file for squirrelmail-imap_proxy server daemon
 #
 # chkconfig: 2345 99 10
 # description:  Imapproxy Daemon 
diff --git a/src/main.c b/src/main.c
index b5f1de1..dfd3113 100644
--- a/src/main.c
+++ b/src/main.c
@@ -638,7 +638,7 @@ int main( int argc, char *argv[] )
 	exit( 1 );
     }
 
-    syslog( LOG_INFO, "%s: imapproxy version %s normal server startup.", fn, IMAP_PROXY_VERSION );
+    syslog( LOG_INFO, "%s: squirrelmail-imap_proxy version %s normal server startup.", fn, IMAP_PROXY_VERSION );
 
     /*
      * Main server loop
@@ -965,8 +965,8 @@ void Daemonize( const char* pidfile )
 /*++
  * Function:	ParseBannerAndCapability
  *
- * Purpose:	Weed out stuff that imapproxy does not support from a banner
- *              line or a capability line.
+ * Purpose:	Weed out stuff that squirrelmail-imap_proxy does not
+ *              support from a banner line or a capability line.
  *
  * Parameters:	char * - Buffer for storing the cleaned up string.
  *              unsigned int - buflen
@@ -1147,7 +1147,7 @@ static int ParseBannerAndCapability( char *DestBuf,
     
     /*
      * Add a 'XIMAPPROXY' CAPABILITY response to indicate that the
-     * current connection is handled by imapproxy.
+     * current connection is handled by squirrelmail-imap_proxy.
      */
     if ( capability == 1 )
     {
diff --git a/src/request.c b/src/request.c
index c348fc5..66f0e15 100644
--- a/src/request.c
+++ b/src/request.c
@@ -860,7 +860,7 @@ static int cmd_authenticate_login( ITD_Struct *Client,
      */
     if (Server.conn->reused == 1)
     {
-	sprintf( SendBuf, "* OK [XPROXYREUSE] IMAP connection reused by imapproxy\r\n" );
+	sprintf( SendBuf, "* OK [XPROXYREUSE] IMAP connection reused by squirrelmail-imap_proxy\r\n" );
 	if ( IMAP_Write( Client->conn, SendBuf, strlen(SendBuf) ) == -1 )
 	{
 	    syslog(LOG_ERR, "%s: IMAP_Write() failed: %s", fn, strerror(errno) );
@@ -1004,7 +1004,7 @@ static int cmd_login( ITD_Struct *Client,
      */
     if (Server.conn->reused == 1)
     {
-	sprintf( SendBuf, "* OK [XPROXYREUSE] IMAP connection reused by imapproxy\r\n" );
+	sprintf( SendBuf, "* OK [XPROXYREUSE] IMAP connection reused by squirrelmail-imap_proxy\r\n" );
 	if ( IMAP_Write( Client->conn, SendBuf, strlen(SendBuf) ) == -1 )
 	{
 	    syslog(LOG_ERR, "%s: IMAP_Write() failed: %s", fn, strerror(errno) );
diff --git a/src/select.c b/src/select.c
index 297e9f2..b6f8514 100644
--- a/src/select.c
+++ b/src/select.c
@@ -13,7 +13,7 @@
 **
 **  Abstract:
 **
-**      routines to support SELECT state caching in imapproxy.
+**      routines to support SELECT state caching in squirrelmail-imap_proxy.
 **
 **  Authors:
 **
diff --git a/src/threads.c b/src/threads.c
index b76e695..bee2a63 100644
--- a/src/threads.c
+++ b/src/threads.c
@@ -56,7 +56,7 @@ static unsigned long id_function(void);
 
 static pthread_mutex_t *locks;
 
-/* We use pthreads, since the rest of imapproxy does. */
+/* We use pthreads, since the rest of squirrelmail-imap_proxy does. */
 
 void ssl_thread_setup(const char *fn) {
     int i, rc;
-- 
2.7.4

