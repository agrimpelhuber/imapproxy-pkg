From 3cf06398b46321407390e9b7094e7dc05b56b4d9 Mon Sep 17 00:00:00 2001
From: Paul Lesniewski <paul@squirrelmail.org>
Date: Mon, 26 Jul 2010 19:39:33 +0000
Subject: [PATCH 01/50] Update copyrights and other administrative actions
 related to the adoption of this software by the SquirrelMail Project

git-svn-id: https://svn.code.sf.net/p/squirrelmail/code/trunk/imap_proxy@14045 7612ce4b-ef26-0410-bec9-ea0150e637f0
---
 COPYING                |  71 ++-------------
 ChangeLog              |   4 +
 Makefile.in            |   2 +-
 README                 |  36 +++-----
 README.debian          |  12 +--
 README.known_issues    |   6 +-
 README.ssl             |  14 +--
 copyright              |   5 +-
 imapproxy.spec         |  11 +--
 include/common.h       |  31 ++-----
 include/imapproxy.h    |  35 +++-----
 pkginfo                |   9 +-
 prototype              |   6 +-
 scripts/imapproxy.conf |  16 ++--
 scripts/imapproxy.init |  30 ++-----
 scripts/pimpdaddy      | 237 +++++++++++++++++++++++++++++++++++++++++++++++++
 scripts/rc.pimpdaddy   |  72 +++++++++++++++
 src/becomenonroot.c    |  31 ++-----
 src/config.c           |  31 ++-----
 src/hash.c             |  32 +++----
 src/icc.c              |  35 +++-----
 src/imapcommon.c       |  35 +++-----
 src/logging.c          |  37 +++-----
 src/main.c             |  53 +++++------
 src/pimpstat.c         |  32 ++-----
 src/request.c          |  39 +++-----
 src/select.c           |  48 ++++------
 src/threads.c          |  38 +++-----
 28 files changed, 534 insertions(+), 474 deletions(-)
 create mode 100755 scripts/pimpdaddy
 create mode 100755 scripts/rc.pimpdaddy

diff --git a/COPYING b/COPYING
index 5b6e7c6..952378a 100644
--- a/COPYING
+++ b/COPYING
@@ -2,7 +2,8 @@
 		       Version 2, June 1991
 
  Copyright (C) 1989, 1991 Free Software Foundation, Inc.
-                       59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
  Everyone is permitted to copy and distribute verbatim copies
  of this license document, but changing it is not allowed.
 
@@ -55,7 +56,7 @@ patent must be licensed for everyone's free use or not licensed at all.
 
   The precise terms and conditions for copying, distribution and
 modification follow.
-
+
 		    GNU GENERAL PUBLIC LICENSE
    TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 
@@ -110,7 +111,7 @@ above, provided that you also meet all of these conditions:
     License.  (Exception: if the Program itself is interactive but
     does not normally print such an announcement, your work based on
     the Program is not required to print an announcement.)
-
+
 These requirements apply to the modified work as a whole.  If
 identifiable sections of that work are not derived from the Program,
 and can be reasonably considered independent and separate works in
@@ -168,7 +169,7 @@ access to copy from a designated place, then offering equivalent
 access to copy the source code from the same place counts as
 distribution of the source code, even though third parties are not
 compelled to copy the source along with the object code.
-
+
   4. You may not copy, modify, sublicense, or distribute the Program
 except as expressly provided under this License.  Any attempt
 otherwise to copy, modify, sublicense or distribute the Program is
@@ -225,7 +226,7 @@ impose that choice.
 
 This section is intended to make thoroughly clear what is believed to
 be a consequence of the rest of this License.
-
+
   8. If the distribution and/or use of the Program is restricted in
 certain countries either by patents or by copyrighted interfaces, the
 original copyright holder who places the Program under this License
@@ -278,63 +279,3 @@ PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGES.
 
 		     END OF TERMS AND CONDITIONS
-
-	    How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-convey the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
-
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) <year>  <name of author>
-
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, write to the Free Software
-    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-
-
-Also add information on how to contact you by electronic and paper mail.
-
-If the program is interactive, make it output a short notice like this
-when it starts in an interactive mode:
-
-    Gnomovision version 69, Copyright (C) year name of author
-    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, the commands you use may
-be called something other than `show w' and `show c'; they could even be
-mouse-clicks or menu items--whatever suits your program.
-
-You should also get your employer (if you work as a programmer) or your
-school, if any, to sign a "copyright disclaimer" for the program, if
-necessary.  Here is a sample; alter the names:
-
-  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
-  `Gnomovision' (which makes passes at compilers) written by James Hacker.
-
-  <signature of Ty Coon>, 1 April 1989
-  Ty Coon, President of Vice
-
-This General Public License does not permit incorporating your program into
-proprietary programs.  If your program is a subroutine library, you may
-consider it more useful to permit linking proprietary applications with the
-library.  If this is what you want to do, use the GNU Library General
-Public License instead of this License.
diff --git a/ChangeLog b/ChangeLog
index bf111a5..d3e60f3 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,7 @@
+2010-07-26  Paul Lesniewski <paul@squirrelmail.org>
+	* Updated copyrights and other administrative actions related to
+          the adoption of this software by the SquirrelMail Project
+
 2010-02-20  Dave McMurtrie  <davemcmurtrie@gmail.com>
 	* common.h: Updated version to 1.2.7
 
diff --git a/Makefile.in b/Makefile.in
index c619230..4b86e63 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -1,4 +1,4 @@
-#### Makefile for IMAP proxy
+#### Makefile for SquirrelMail IMAP Proxy
 #### Contributed by Gary Mills <mills@cc.UManitoba.CA>
 
 # Fixed to work with configure script
diff --git a/README b/README
index 96c0134..c187da6 100644
--- a/README
+++ b/README
@@ -1,14 +1,15 @@
-                 Copyright (c) 2002,2003 Dave McMurtrie
+     Copyright (c) 2010-     The SquirrelMail Project Team
+     Copyright (c) 2002-2010 Dave McMurtrie
 
 
-This directory contains the source distribution of up-imapproxy.
+This directory contains the source distribution of SquirrelMail IMAP Proxy.
 
-If you find any bugs in up-imapproxy, please subscribe to the imapproxy-info
-mailing list and post your bug there.
+If you find any bugs in squirrelmail-imapproxy, please subscribe to the
+squirrelmail-imapproxy mailing list and post your bug there.
 
-If you want to subscribe to the imapproxy-info mailing list, visit:
+If you want to subscribe to the squirrelmail-imapproxy mailing list, visit:
 
-http://lists.andrew.cmu.edu/mailman/listinfo/imapproxy-info
+https://lists.sourceforge.net/lists/listinfo/squirrelmail-imapproxy
 
 For some Debian specific issues that have come up, read the file README.debian.
 
@@ -69,7 +70,7 @@ CONFIGURATION OPTIONS
 
 server_hostname
 ---------------
-This determines which imap server you want to proxy connections to.
+This determines which IMAP server you want to proxy connections to.
 
 cache_size
 ----------
@@ -215,7 +216,7 @@ ADDITIONAL COMMANDS:
 
 There are a few additional commands that have been added to allow you to
 administer the proxy server.  They're implemented through the same mechanism
-as regular imap protocol commands, so they require you to telnet to your
+as regular IMAP protocol commands, so they require you to telnet to your
 proxy server on whatever port you choose to bind to and type them like a
 regular protocol transaction.  At our site, we've severely limited access to
 the proxy port such that only our webmail machines and one internal admin
@@ -326,20 +327,5 @@ S: a001 OK Completed
 
 Happy proxying,
 
-Dave  <davemcmurtrie@gmail.com>
-
-
-                              _________
-                             /        |
-                            /         |
-                           /    ______|
-                          /    /       ________
-                         |    |        |      /
-                         |    |        |_____/
-                         |    |        ______
-                         |    |        |     \
-                         |    |        |______\
-                          \    \_______
-                           \           |
-                            \          |
-                             \_________|
+The SquirrelMail Project Team
+
diff --git a/README.debian b/README.debian
index 8c642d3..781a09b 100644
--- a/README.debian
+++ b/README.debian
@@ -1,17 +1,17 @@
 Michael Faurot <mfaurot at atww.org> submitted some helpful information
-for people building and installing up-imapproxy on Debian Linux systems.
-I've included his information here, exactly as he submitted it.
+for people building and installing squirrelmail-imapproxy on Debian Linux
+systems.  I've included his information here, exactly as he submitted it.
 
-It's now worth noting that there's an official Debian package for up-imapproxy
-(courtesy of Jose Luis Tallon) so you might want to save yourself some time 
-and effort and just apt-get that.
+It's now worth noting that there's an official Debian package for
+squirrelmail-imapproxy (courtesy of Jose Luis Tallon) so you might
+want to save yourself some time and effort and just apt-get that.
 
 
 o)	On a Debian system that uses UW IMAP you'll need to rename
 	/etc/rc2.d/S99rmnologin to something like S98rmnologin.  Then be
 	sure the rc script for imapproxy is run as S99imapproxy.
 	This insures that when imapproxy goes to query the imap
-	daemon, the imap daemon will actually say it's ready.  UW IMAP
+	daemon, the IMAP daemon will actually say it's ready.  UW IMAP
 	respects the /etc/nologin file, and if imapproxy queries while
 	/etc/nologin is still present, imapproxy will fail to start.
 	Debian creates /etc/nologin during the early stages of bootup,
diff --git a/README.known_issues b/README.known_issues
index c832cb1..3e76ebd 100644
--- a/README.known_issues
+++ b/README.known_issues
@@ -1,7 +1,7 @@
 README was starting to become too cluttered, so I split out a few known
 issues that you may encounter and stuck them in this file.  If you already
-built up-imapproxy and didn't encounter any problems, you probably don't
-need to read any further.
+built squirrelmail-imapproxy and didn't encounter any problems, you probably
+don't need to read any further.
 
 -------------------------------------------------------------------------------
 Problem: configure cannot find the openssl libraries.
@@ -74,5 +74,5 @@ Problem: Attempting to build rpm on RedHat 9 or RedHat Enterprise Linux 3 fails
 
 Symptom:  
 
-Fix:     rpmbuild -tb up-imapproxy-1.2.3.tar.gz --define 'with_krb5 1'
+Fix:     rpmbuild -tb squirrelmail-imapproxy-1.2.3.tar.gz --define 'with_krb5 1'
 -------------------------------------------------------------------------------
diff --git a/README.ssl b/README.ssl
index 1808be8..a3cac2c 100644
--- a/README.ssl
+++ b/README.ssl
@@ -1,19 +1,19 @@
-First, if you're using up-imapproxy with SSL, you have Ken Murchison
-to thank for that.  He added this feature.
+First, if you're using squirrelmail-imapproxy with SSL, you have Ken
+Murchison to thank for that.  He added this feature.
 
-up-imapproxy only supports TLS between the proxy server and the real
-IMAP server.  It does not support TLS between a client (usually webmail)
-and the proxy server.  The idea here is that you can run the imap proxy on
+squirrelmail-imapproxy only supports TLS between the proxy server and the
+real IMAP server.  It does not support TLS between a client (usually webmail)
+and the proxy server.  The idea here is that you can run the IMAP proxy on
 the same machine as your webserver.  If you're using TLS to your webserver,
 the webserver can then send plaintext auth to the proxy without the password
 ever crossing the network, then the proxy can use TLS to the IMAP server.
 
-The proxy will only use TLS if the real imap server forces it to do so by
+The proxy will only use TLS if the real IMAP server forces it to do so by
 advertising LOGINDISABLED in the capability string.
 
 imapproxy does not support the deprecated notion of imaps using port 993.
 It only supports the use of the STARTTLS command to initiate SSL/TLS from
-within a regular imap connection.
+within a regular IMAP connection.
 
 There are four configuration file options that you'll have to set in order
 for SSL to work.  They are tls_ca_file, tls_ca_path, tls_cert_file and
diff --git a/copyright b/copyright
index 12735dd..3f2aee9 100644
--- a/copyright
+++ b/copyright
@@ -1,3 +1,4 @@
 
-              Copyright (c) 2002-2004 Dave McMurtrie
-	
+ Copyright (c) 2010-     The SquirrelMail Project Team
+ Copyright (c) 2002-2010 Dave McMurtrie
+
diff --git a/imapproxy.spec b/imapproxy.spec
index e20a795..9c2293e 100644
--- a/imapproxy.spec
+++ b/imapproxy.spec
@@ -10,23 +10,24 @@
 # with_krb5 indicates the Kerberos includes are needed (ie: Red Hat Linux 9)
 %{?with_krb5:%define withkrb5 1}
 
-Summary:	Imapproxy Daemon
-Name:		up-imapproxy
+Summary:	IMAP Proxy Daemon
+Name:		SquirrelMail IMAP Proxy
 Version:	%ver
 Release:	%rel
+#Copyright:	The SquirrelMail Project Team
 #Copyright:	Dave McMurtrie
 License:        GPL
 Group:		Networking/Daemons
-Source0:	http://www.imapproxy.org/downloads/up-imapproxy-%{ver}.tar.gz
+Source0:	http://squirrelmail.org/download.php
 #Source1:	imapproxy.conf
 #Source2:	imapproxy.init
-Url:		http://www.imapproxy.org
+Url:		http://imapproxy.org
 Packager:	Devrim SERAL <devrim@gazi.edu.tr>
 #BuildRoot:	/var/tmp/imapproxy-%{ver}-root
 BuildRoot:	%{_tmppath}/%{name}-%{ver}-root
 
 %description
-This is a connection caching imapproxy daemon for proxied imap connections
+This is a connection caching IMAP proxy daemon for proxied IMAP connections
 
 %prep
 %setup 
diff --git a/include/common.h b/include/common.h
index fe041df..fb3dd7a 100644
--- a/include/common.h
+++ b/include/common.h
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -32,14 +20,14 @@
 **
 **      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/include/RCS/common.h,v $
-**      $Id: common.h,v 1.12 2010/02/20 17:15:21 dave64 Exp $
-**      
 **  Modification History:
 **
-**      $Log: common.h,v $
+**      $Log$
+**
 **      Revision 1.12  2010/02/20 17:15:21  dave64
 **      updated version to 1.2.7
 **
@@ -76,7 +64,6 @@
 **      Revision 1.1  2002/08/29 16:31:19  dgm
 **      Initial revision
 **
-**
 */
 
 #ifndef __COMMON_H
diff --git a/include/imapproxy.h b/include/imapproxy.h
index f908184..0598663 100644
--- a/include/imapproxy.h
+++ b/include/imapproxy.h
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -25,20 +13,20 @@
 **
 **  Abstract:
 **
-**	Common definitions and function prototypes for the imap proxy server.
+**	Common definitions and function prototypes for the IMAP proxy server.
 **
 **  Authors:
 **
 **      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/include/RCS/imapproxy.h,v $
-**      $Id: imapproxy.h,v 1.30 2009/10/16 14:35:17 dave64 Exp $
-**      
 **  Modification History:
 **
-**      $Log: imapproxy.h,v $
+**      $Log$
+**
 **      Revision 1.30  2009/10/16 14:35:17  dave64
 **      Applied patch by Jose Luis Tallon to improve server connect retry logic.
 **
@@ -146,7 +134,6 @@
 **      Revision 1.1  2002/07/03 11:21:12  dgm
 **      Initial revision
 **
-**
 */
 
 
@@ -281,7 +268,7 @@ struct IMAPConnectionContext
  * One ProxyConfig structure will be used globally to keep track of
  * configurable options.  All of these options are set by reading values
  * from the global config file except for support_unselect.  That's set
- * based on the CAPABILITY string from the real imap server.
+ * based on the CAPABILITY string from the real IMAP server.
  */
 struct ProxyConfig
 {
diff --git a/pkginfo b/pkginfo
index 2180ef2..c527bfd 100644
--- a/pkginfo
+++ b/pkginfo
@@ -1,10 +1,9 @@
-PKG=UPimapproxy
-NAME=up-imapproxy
+PKG=imapproxy
+NAME=SquirrelMail IMAP Proxy
 ARCH=sparc
 VERSION=1.2.7
 CATEGORY=application
-VENDOR=www.imapproxy.org
-DESC=This is a connection caching imapproxy daemon for proxied imap connections
-EMAIL=davemcmurtrie@gmail.com
+VENDOR=imapproxy.org
+DESC=This is a connection caching IMAP proxy daemon for proxied IMAP connections
 BASEDIR=/usr/local
 CLASSES=none
diff --git a/prototype b/prototype
index 927dd81..2a06f18 100644
--- a/prototype
+++ b/prototype
@@ -8,9 +8,9 @@ l none /etc/rc2.d/K10imapproxy=/etc/init.d/imapproxy
 l none /etc/rc3.d/S99imapproxy=/etc/init.d/imapproxy
 l none /etc/rcS.d/K10imapproxy=/etc/init.d/imapproxy
 d none doc 0755 root sys
-d none doc/up-imapproxy 0755 root sys
-f none doc/up-imapproxy/ChangeLog=ChangeLog 0644 root sys
-f none doc/up-imapproxy/README=README 0644 root sys
+d none doc/squirrelmail-imapproxy 0755 root sys
+f none doc/squirrelmail-imapproxy/ChangeLog=ChangeLog 0644 root sys
+f none doc/squirrelmail-imapproxy/README=README 0644 root sys
 d none sbin 0755 root sys
 f none sbin/in.imapproxyd=bin/in.imapproxyd 0755 root sys
 f none sbin/pimpstat=bin/pimpstat 0755 root sys
diff --git a/scripts/imapproxy.conf b/scripts/imapproxy.conf
index 57d7b1b..5ce1fad 100644
--- a/scripts/imapproxy.conf
+++ b/scripts/imapproxy.conf
@@ -1,6 +1,6 @@
 ## imapproxy.conf
 ##
-## This is the global configuration file for imapproxy.
+## This is the global configuration file for SquirrelMail IMAP Proxy.
 ## Lines beginning with a '#' sign are treated as comments and will be
 ## ignored.  Each line to be processed must be a space delimited
 ## keyword/value pair.  
@@ -9,7 +9,7 @@
 #
 ## server_hostname
 ##
-## This setting controls which imap server we proxy our connections to.
+## This setting controls which IMAP server we proxy our connections to.
 #
 server_hostname your.imap.server.com
 
@@ -26,7 +26,7 @@ connect_delay 5
 #
 ## cache_size
 ##
-## This setting determines how many in-core imap connection structures
+## This setting determines how many in-core IMAP connection structures
 ## will be allocated.  As such, it determines not only how many cached
 ## connections will be allowed, but really the total number of simultaneous
 ## connections, cached and active.
@@ -73,7 +73,7 @@ cache_expiration_time 300
 #
 ## proc_username
 ##
-## This setting controls which username the imap proxy process will run as.
+## This setting controls which username the IMAP proxy process will run as.
 ## It is not allowed to run as "root".
 #
 proc_username nobody
@@ -81,7 +81,7 @@ proc_username nobody
 #
 ## proc_groupname
 ##
-## This setting controls which groupname the imap proxy process will run as.
+## This setting controls which groupname the IMAP proxy process will run as.
 #
 proc_groupname nobody
 
@@ -142,8 +142,8 @@ send_tcp_keepalives no
 ## enable_select_cache
 ##
 ## This configuration option allows you to turn select caching on or off.
-## When select caching is enabled, up-imapproxy will cache SELECT responses
-## from an imap server.
+## When select caching is enabled, squirrelmail-imapproxy will cache SELECT
+## responses from an IMAP server.
 #
 enable_select_cache no
 
@@ -190,4 +190,4 @@ enable_admin_commands no
 #tls_ca_file /usr/share/ssl/certs/ca-bundle.crt
 #tls_ca_path /usr/share/ssl/certs/
 #tls_cert_file /usr/share/ssl/certs/mycert.crt
-#tls_key_file /usr/share/ssl/certs/mycert.key
\ No newline at end of file
+#tls_key_file /usr/share/ssl/certs/mycert.key
diff --git a/scripts/imapproxy.init b/scripts/imapproxy.init
index 28a68bf..7a39d35 100755
--- a/scripts/imapproxy.init
+++ b/scripts/imapproxy.init
@@ -1,23 +1,11 @@
 #!/bin/sh
-## 
-##               Copyright (c) 2002,2003 Dave McMurtrie
 ##
-## This file is part of imapproxy.
+## Copyright (c) 2010-     The SquirrelMail Project Team
+## Copyright (c) 2002-2010 Dave McMurtrie
 ##
-## imapproxy is free software; you can redistribute it and/or modify
-## it under the terms of the GNU General Public License as published by
-## the Free Software Foundation; either version 2 of the License, or
-## (at your option) any later version.
-##
-## imapproxy is distributed in the hope that it will be useful,
-## but WITHOUT ANY WARRANTY; without even the implied warranty of
-## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-## GNU General Public License for more details.
-##
-## You should have received a copy of the GNU General Public License
-## along with imapproxy; if not, write to the Free Software
-## Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+## Licensed under the GNU GPL. For full terms see the file COPYING.
 ##
+## This file is part of SquirrelMail IMAP Proxy.
 ##
 ##  Facility:
 ##
@@ -31,14 +19,14 @@
 ##
 ##      Dave McMurtrie <davemcmurtrie@hotmail.com>
 ##
-##  RCS:
+##  Version:
+##
+##      $Id$
 ##
-##      $Source: /afs/pitt.edu/usr12/dgm/work/IMAP_Proxy/scripts/RCS/imapproxy,v $
-##      $Id: imapproxy,v 1.2 2002/12/19 21:48:07 dgm Exp $
-##      
 ##  Modification History:
 ##
-##      $Log: imapproxy,v $
+##      $Log$
+##
 ##      Revision 1.2  2002/12/19 21:48:07  dgm
 ##      Removed the notion of the startup script reading the config file and
 ##      passing arguments to the server process on startup.
diff --git a/scripts/pimpdaddy b/scripts/pimpdaddy
new file mode 100755
index 0000000..cd3137d
--- /dev/null
+++ b/scripts/pimpdaddy
@@ -0,0 +1,237 @@
+#!/usr/bin/perl
+##
+## Copyright (c) 2010-     The SquirrelMail Project Team
+## Copyright (c) 2002-2010 Dave McMurtrie
+##
+## Licensed under the GNU GPL. For full terms see the file COPYING.
+##
+## This file is part of SquirrelMail IMAP Proxy.
+##
+##  Facility:
+##
+##      pimpdaddy
+##	IMAP Proxy "daddy" process
+##
+##  Abstract:
+##
+##	To monitor the IMAP Proxy daemon and restart it if it dies or
+##	hangs.
+##
+##  Authors:
+##
+##      Dave McMurtrie <davemcmurtrie@hotmail.com>
+##
+##  Version:
+##
+##      $Id$
+##
+##  Modification History:
+##
+##      $Log$
+##
+##      Revision 1.1  2002/09/06 18:41:08  dgm
+##      Initial revision
+##
+
+use strict;
+use Socket;
+
+my $Pgm = (reverse(split(/\//, $0)))[0];
+my $addr = "localhost";
+my $port = 143;
+my $ipaddr = inet_aton( $addr );
+my $paddr = sockaddr_in( $port, $ipaddr );
+my $protocol = getprotobyname( 'tcp' );
+my $console = "/dev/console";
+
+
+#
+## Function definitions
+#
+
+#++
+# Function:	Fatal
+#
+# Purpose:	echo fatal error messages to the console and die.
+#
+# Parameters:	scalar -- the message to echo 
+#
+# Returns:	nada, it exits.
+#
+# Authors:	dgm
+#
+# Notes:
+#--
+sub Fatal($)
+{
+    my $Message = shift @_;
+    chomp $Message;
+
+    open( ERR, ">$console" );
+    print( ERR "$Pgm: FATAL: $Message\n ");
+    exit( 1 );
+}
+
+
+
+#++
+# Function:	Alert
+#
+# Purpose:	echo alert messages to the console.
+#
+# Parameters:	scalar -- the message to echo 
+#
+# Returns:	nada.
+#
+# Authors:	dgm
+#
+# Notes:
+#--
+sub Alert($)
+{
+    my $Message = shift @_;
+    chomp $Message;
+
+    open( ERR, ">$console" );
+    print( ERR "$Pgm: ALERT: $Message\n ");
+    close( ERR );
+}
+
+
+#++
+# Function:	Restart
+#
+# Purpose:	restart the IMAP proxy server
+#
+# Parameters:	nada. 
+#
+# Returns:	nada.
+#
+# Authors:	dgm
+#
+# Notes:
+#--
+sub Restart()
+{
+    system( "/etc/init.d/imapproxy", "stop" );
+    sleep( 3 );
+    system( "/etc/init.d/imapproxy", "start" );
+    sleep( 10 );
+}
+
+
+#
+## Start of main script.
+#
+
+# When we first start, sleep for a while since we don't know for sure
+# what order we might get started in.  We don't want to fight with
+# the imapproxy startup script.
+sleep( 30 );
+
+$SIG{ALRM} = sub{ die "timeout" };
+
+
+#
+## Loop infinitely and make sure we can connect
+## to the IMAP proxy server.
+#
+for ( ;; )
+{
+    unless( socket( SOCK, PF_INET, SOCK_STREAM, $protocol ) )
+    {
+	Fatal("socket() failed: $!");
+    }
+
+    #
+    ## Turn off I/O buffering for the socket filehandle.
+    #
+    select((select(SOCK), $| = 1)[0]);
+
+
+    unless( connect( SOCK, $paddr ) )
+    {
+	Alert( "Failed to connect to the IMAP proxy server: $! -- Restarting IMAP proxy server.");
+	close( SOCK );
+
+	Restart();
+
+	next;
+    }
+
+    #
+    ## we're connected.  Try to read the banner line, but make sure we will
+    ## time out eventually if the server happens to be hung.  We can't just
+    ## set an alarm because perl uses alarms internally, so we have to use
+    ## this eval/die hokum...
+    #
+    eval
+    {
+	alarm( 60 );
+	$_ = ( <SOCK> );
+	alarm( 0 );
+    };
+
+    if ( $@ )
+    {
+	if ( $@ =~ /timeout/ )
+	{
+	    Alert( "read() timed out.  Restarting the IMAP proxy server." );
+	    close( SOCK );
+	    Restart();
+	    next;
+	}
+	else
+	{
+	    alarm(0);
+	    die;
+	}
+    }
+
+
+    unless ( /^\* OK / )
+    {
+	Alert( "Did not receive OK login banner from IMAP proxy server -- Restarting IMAP proxy server." );
+	close( SOCK );
+	Restart();
+	next;
+    }
+    
+    print( SOCK "1 LOGOUT\r\n" );
+
+    # eat the login response.
+    eval
+    {
+	alarm( 60 );
+	$_ = ( <SOCK> );
+	alarm( 0 );
+    };
+
+    if ( $@ )
+    {
+	if ( $@ =~ /timeout/ )
+	{
+	    Alert( "read() timed out.  Restarting the IMAP proxy server." );
+	    close( SOCK );
+	    Restart();
+	    next;
+	}
+	else
+	{
+	    alarm(0);
+	    die;
+	}
+    }
+
+    close( SOCK );
+
+    sleep( 5 );
+
+}
+    
+
+
+
+
+
+
diff --git a/scripts/rc.pimpdaddy b/scripts/rc.pimpdaddy
new file mode 100755
index 0000000..1c37189
--- /dev/null
+++ b/scripts/rc.pimpdaddy
@@ -0,0 +1,72 @@
+#!/bin/sh
+##
+## Copyright (c) 2010-     The SquirrelMail Project Team
+## Copyright (c) 2002-2010 Dave McMurtrie
+##
+## Licensed under the GNU GPL. For full terms see the file COPYING.
+##
+## This file is part of SquirrelMail IMAP Proxy.
+##
+##  Facility:
+##
+##	rc.pimpdaddy
+##
+##  Abstract:
+##
+##	pimpdaddy startup script
+##
+##  Authors:
+##
+##      Dave McMurtrie <davemcmurtrie@hotmail.com>
+##
+##  Version:
+##
+##      $Id$
+##
+##  Modification History:
+##
+##      $Log$
+##
+##      Revision 1.1  2002/09/06 18:41:20  dgm
+##      Initial revision
+##
+
+Pgm=`/bin/basename $0`
+
+
+case $1 in
+
+    'start')
+
+	# make sure the executable exists.
+
+	if [ ! -f /usr/local/sbin/pimpdaddy ]; then
+	    /bin/echo "$Pgm: /usr/local/sbin/pimpdaddy does not exist.  Not starting pimpdaddy." 1>&2
+	    exit 1
+	fi
+
+	/bin/echo "$Pgm: Starting pimpdaddy." 1>&2
+
+	/usr/local/sbin/pimpdaddy &
+
+	;;
+
+
+
+    'stop')
+
+	/bin/echo "$Pgm: Shutting down pimpdaddy." 1>&2
+
+	pkill -x pimpdaddy
+
+	;;
+
+
+    *)
+	/bin/echo "usage: $Pgm {start|stop}" 1>&2
+
+	exit 0
+
+	;;
+
+esac
diff --git a/src/becomenonroot.c b/src/becomenonroot.c
index aef68a6..292ad07 100644
--- a/src/becomenonroot.c
+++ b/src/becomenonroot.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -32,14 +20,14 @@
 **
 **      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/pitt.edu/usr12/dgm/work/IMAP_Proxy/src/RCS/becomenonroot.c,v $
-**      $Id: becomenonroot.c,v 1.4 2005/06/15 12:10:12 dgm Exp $
-**      
 **  Modification History:
 **
-**      $Log: becomenonroot.c,v $
+**      $Log$
+**
 **      Revision 1.4  2005/06/15 12:10:12  dgm
 **      Conditionally include unistd.h.  Include config.h.  Patch
 **      by Jarno Huuskonen to drop any supplemental group memberships.
@@ -54,7 +42,6 @@
 **      Revision 1.1  2002/08/29 16:24:31  dgm
 **      Initial revision
 **
-**
 */
 
 #include <config.h>
diff --git a/src/config.c b/src/config.c
index bb40f77..7d16e77 100644
--- a/src/config.c
+++ b/src/config.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -32,14 +20,14 @@
 **
 **      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/config.c,v $
-**      $Id: config.c,v 1.18 2009/10/16 14:34:49 dave64 Exp $
-**      
 **  Modification History:
 **
-**      $Log: config.c,v $
+**      $Log$
+**
 **      Revision 1.18  2009/10/16 14:34:49  dave64
 **      Applied patch by Jose Luis Tallon to improve server connect retry logic.
 **
@@ -100,7 +88,6 @@
 **      Revision 1.1  2002/12/17 14:26:49  dgm
 **      Initial revision
 **
-**
 */
 
 
diff --git a/src/hash.c b/src/hash.c
index e65b6f2..b578641 100644
--- a/src/hash.c
+++ b/src/hash.c
@@ -1,26 +1,15 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
+**      hash.c
 **	Hashing routines
 **
 **  Abstract:
@@ -31,21 +20,20 @@
 **
 **      Ben Carter
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/pitt.edu/usr12/dgm/work/IMAP_Proxy/src/RCS/hash.c,v $
-**      $Id: hash.c,v 1.2 2003/05/20 18:43:52 dgm Exp $
-**      
 **  Modification History:
 **
-**      $Log: hash.c,v $
+**      $Log$
+**
 **      Revision 1.2  2003/05/20 18:43:52  dgm
 **      comment changes only.
 **
 **      Revision 1.1  2002/08/29 16:27:23  dgm
 **      Initial revision
 **
-**
 */
 
 
diff --git a/src/icc.c b/src/icc.c
index 3fc0363..eb876c2 100644
--- a/src/icc.c
+++ b/src/icc.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -29,16 +17,16 @@
 **
 **  Authors:
 **
-**	Author: Dave McMurtrie <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
+**
+**  Version:
 **
-**  RCS:
+**      $Id$
 **
-**	$Source: /afs/pitt.edu/usr12/dgm/work/IMAP_Proxy/src/RCS/icc.c,v $
-**	$Id: icc.c,v 1.8 2005/06/15 12:02:08 dgm Exp $
-**      
 **  Modification History:
 **
-**	$Log: icc.c,v $
+**      $Log$
+**
 **	Revision 1.8  2005/06/15 12:02:08  dgm
 **	Include config.h.
 **
@@ -64,7 +52,6 @@
 **	Revision 1.1  2002/07/03 12:06:58  dgm
 **	Initial revision
 **
-**
 */
 
 
@@ -147,7 +134,7 @@ static void _ICC_Recycle( unsigned int Expiration )
 		   Expiration ) )
 	    {
 		syslog(LOG_INFO, "Expiring server sd [%d]", HashEntry->server_conn->sd);
-		/* Logout of the imap server and close the server socket. */
+		/* Logout of the IMAP server and close the server socket. */
 
 		IMAP_Write( HashEntry->server_conn, "VIC20 LOGOUT\r\n",
 			    strlen( "VIC20 LOGOUT\r\n" ) );
diff --git a/src/imapcommon.c b/src/imapcommon.c
index bdab429..156620a 100644
--- a/src/imapcommon.c
+++ b/src/imapcommon.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -30,16 +18,16 @@
 **
 **  Authors:
 **
-**	Dave McMurtrie <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
+**
+**  Version:
 **
-**  RCS:
+**      $Id$
 **
-**	$Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/imapcommon.c,v $
-**	$Id: imapcommon.c,v 1.25 2008/10/20 13:23:04 dave64 Exp $
-**      
 **  Modification History:
 **
-**	$Log: imapcommon.c,v $
+**      $Log$
+**
 **	Revision 1.25  2008/10/20 13:23:04  dave64
 **	Applied patch by Michael M. Slusarz to support XPROXYREUSE.
 **
@@ -133,7 +121,6 @@
 **	Revision 1.1  2002/07/03 12:07:26  dgm
 **	Initial revision
 **
-**
 */
 
 
@@ -1250,7 +1237,7 @@ extern int IMAP_Literal_Read( ITD_Struct *ITD )
 /*++
  * Function:	IMAP_Line_Read
  *
- * Purpose:	Line-oriented buffered reads from the imap server
+ * Purpose:	Line-oriented buffered reads from the IMAP server
  *
  * Parameters:	ptr to a IMAPTransactionDescriptor structure
  *
diff --git a/src/logging.c b/src/logging.c
index 9e42fcd..75e18b5 100644
--- a/src/logging.c
+++ b/src/logging.c
@@ -1,44 +1,32 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
-**    logging.c
+**      logging.c
 **
 **  Abstract:
 **
-**    Routines to allow syslog levels and facilities to be configurable.
+**      Routines to allow syslog levels and facilities to be configurable.
 **
 **  Authors:
 **
-**      Dave McMurtrie  <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
+**
+**  Version:
 **
-**  RCS:
+**      $Id$
 **
-**      $Source: /afs/pitt.edu/usr12/dgm/work/IMAP_Proxy/src/RCS/logging.c,v $
-**      $Id: logging.c,v 1.4 2005/06/15 12:10:39 dgm Exp $
-**      
 **  Modification History:
 **
-**      $Log: logging.c,v $
+**      $Log$
+**
 **      Revision 1.4  2005/06/15 12:10:39  dgm
 **      Include string.h.
 **
@@ -52,7 +40,6 @@
 **      Revision 1.1  2003/04/16 12:14:31  dgm
 **      Initial revision
 **
-**
 */
 
 #include <syslog.h>
diff --git a/src/main.c b/src/main.c
index 7c709f6..b5f1de1 100644
--- a/src/main.c
+++ b/src/main.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -31,16 +19,16 @@
 **
 **  Authors:
 **
-**	Dave McMurtrie <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
+**
+**  Version:
 **
-**  RCS:
+**      $Id$
 **
-**	$Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/main.c,v $
-**	$Id: main.c,v 1.40 2009/10/16 14:34:16 dave64 Exp $
-**      
 **  Modification History:
 **
-**      $Log: main.c,v $
+**      $Log$
+**
 **      Revision 1.40  2009/10/16 14:34:16  dave64
 **      Applied patch by Jose Luis Tallon to improve server connect retry logic.
 **
@@ -196,13 +184,12 @@
 **	Revision 1.1  2002/07/03 12:07:51  dgm
 **	Initial revision
 **
-**
 */
 
 
-static char *rcsId = "$Id: main.c,v 1.40 2009/10/16 14:34:16 dave64 Exp $";
-static char *rcsSource = "$Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/main.c,v $";
-static char *rcsAuthor = "$Author: dave64 $";
+static char *sourceRevision = "$Revision$";
+static char *sourceVersion = "$Id$";
+static char *sourceAuthor = "$Author$";
 
 #define _REENTRANT
 
@@ -246,17 +233,17 @@ static char *rcsAuthor = "$Author: dave64 $";
 /*
  * Global variables.  Many of these things are global just as an optimization.
  * For example, there's no reason to have to do a hostname lookup every
- * single time we want to connect to the imap server.  We do it once and 
+ * single time we want to connect to the IMAP server.  We do it once and 
  * store it globally.
  */
 char Banner[BUFSIZE];                /* banner line returned from IMAP svr */
 unsigned int BannerLen;
 char Capability[BUFSIZE];            /* IMAP capability line from server */
 unsigned int CapabilityLen;
-ISD_Struct ISD;                      /* global imap server descriptor */
+ISD_Struct ISD;                      /* global IMAP server descriptor */
 ICC_Struct *ICC_free;                /* ICC free listhead */
 ICC_Struct *ICC_HashTable[ HASH_TABLE_SIZE ];
-IMAPCounter_Struct *IMAPCount;       /* global imap counter struct */
+IMAPCounter_Struct *IMAPCount;       /* global IMAP counter struct */
 pthread_mutex_t mp;                  /* "main" mutex used for ICC sync */
 pthread_mutex_t trace;               /* mutex used for username tracing */
 char TraceUser[MAXUSERNAMELEN];      /* username we want to trace */
@@ -800,7 +787,7 @@ static void ServerInit( void )
     }
     
     
-    /* grab a host entry for the imap server. */
+    /* grab a host entry for the IMAP server. */
     syslog( LOG_INFO, "%s: proxying to IMAP server '%s'.", fn, 
 	    PC_Struct.server_hostname );
     
@@ -1216,7 +1203,7 @@ static void SetBannerAndCapability( void )
 	
 	if ( connect( sd, (struct sockaddr *)ISD.srv->ai_addr, 
 		      ISD.srv->ai_addrlen ) == -1 ) 	{
-	    syslog(LOG_ERR, "%s: connect() to imap server on socket [%d] failed: %s -- retrying", fn, sd, strerror(errno));
+	    syslog(LOG_ERR, "%s: connect() to IMAP server on socket [%d] failed: %s -- retrying", fn, sd, strerror(errno));
 	    close( sd );
 	    
 	    sleep( 15 );    /* IMAP server may not be started yet. */
@@ -1260,7 +1247,7 @@ static void SetBannerAndCapability( void )
      */
     if ( strncasecmp( Banner, IMAP_UNTAGGED_OK, strlen(IMAP_UNTAGGED_OK)) )
     {
-	syslog(LOG_ERR, "%s: Unexpected response from imap server on initial connection: %s -- Exiting.", fn, Banner);
+	syslog(LOG_ERR, "%s: Unexpected response from IMAP server on initial connection: %s -- Exiting.", fn, Banner);
 	close( itd.conn->sd );
 	exit( 1 );
     }
@@ -1321,7 +1308,7 @@ static void SetBannerAndCapability( void )
     
     if ( strncasecmp( itd.ReadBuf, IMAP_TAGGED_OK, strlen(IMAP_TAGGED_OK) ) )
     {
-	syslog(LOG_ERR, "%s: Received non-OK tagged reponse from imap server on CAPABILITY command -- exiting.", fn );
+	syslog(LOG_ERR, "%s: Received non-OK tagged reponse from IMAP server on CAPABILITY command -- exiting.", fn );
 	close( itd.conn->sd );
 	exit( 1 );
     }
diff --git a/src/pimpstat.c b/src/pimpstat.c
index 1006758..1084dbd 100644
--- a/src/pimpstat.c
+++ b/src/pimpstat.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -31,14 +19,14 @@
 **
 **      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/pimpstat.c,v $
-**      $Id: pimpstat.c,v 1.9 2006/02/17 01:42:37 dave64 Exp $
-**      
 **  Modification History:
 **
-**      $Log: pimpstat.c,v $
+**      $Log$
+**
 **      Revision 1.9  2006/02/17 01:42:37  dave64
 **      Spelling correction (Connectsions) by Matt Selsky.
 **
@@ -68,8 +56,6 @@
 **      Revision 1.1  2002/08/30 13:32:55  dgm
 **      Initial revision
 **
-**
-**
 */
 
 
diff --git a/src/request.c b/src/request.c
index 627036f..c348fc5 100644
--- a/src/request.c
+++ b/src/request.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002,2003 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -34,16 +22,16 @@
 **
 **  Authors:
 **
-**	Dave McMurtrie <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
+**
+**  Version:
 **
-**  RCS:
+**      $Id$
 **
-**	$Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/request.c,v $
-**	$Id: request.c,v 1.25 2009/10/16 14:12:55 dave64 Exp $
-**      
 **  Modification History:
 **
-**	$Log: request.c,v $
+**      $Log$
+**
 **	Revision 1.25  2009/10/16 14:12:55  dave64
 **	applied patch by Jose Luis Tallon to fix compiler warnings
 **
@@ -139,7 +127,6 @@
 **	Revision 1.1  2002/07/03 12:08:34  dgm
 **	Initial revision
 **
-**
 */
 
 
@@ -358,7 +345,7 @@ static int cmd_resetcounters( ITD_Struct *itd, char *Tag )
 /*++
  * Function:	cmd_dumpicc
  *
- * Purpose:	Dump the contents of all imap connection context structs.
+ * Purpose:	Dump the contents of all IMAP connection context structs.
  *
  * Parameters:	ptr to ITD_Struct for client connection.
  *              char ptr to Tag sent with this command.
@@ -1519,7 +1506,7 @@ static int Raw_Proxy( ITD_Struct *Client, ITD_Struct *Server,
 /*++
  * Function:	HandleRequest
  *
- * Purpose:	Handle incoming imap requests (as a thread)
+ * Purpose:	Handle incoming IMAP requests (as a thread)
  *
  * Parameters:	int, client socket descriptor
  *
@@ -1528,7 +1515,7 @@ static int Raw_Proxy( ITD_Struct *Client, ITD_Struct *Server,
  * Authors:	Dave McMurtrie <davemcmurtrie@hotmail.com>
  *
  * Notes:	This function actually only handles unauthenticated
- *		traffic from an imap client.  As such it can only make sense
+ *		traffic from an IMAP client.  As such it can only make sense
  *		of the following IMAP commands (rfc 2060):  NOOP, CAPABILITY,
  *		AUTHENTICATE, LOGIN, and LOGOUT.  Also, it handles the
  *              commands that are internal to the proxy server such as
diff --git a/src/select.c b/src/select.c
index 3b4456c..297e9f2 100644
--- a/src/select.c
+++ b/src/select.c
@@ -1,23 +1,11 @@
 /*
-** 
-**               Copyright (c) 2002-2004 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
@@ -29,16 +17,16 @@
 **
 **  Authors:
 **
-**	Dave McMurtrie <davemcmurtrie@hotmail.com>
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
+**
+**      $Id$
 **
-**      $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/select.c,v $
-**      $Id: select.c,v 1.5 2009/10/16 14:22:38 dave64 Exp $
-**      
 **  Modification History:
-**  
-**      $Log: select.c,v $
+**
+**      $Log$
+**
 **      Revision 1.5  2009/10/16 14:22:38  dave64
 **      Applied patch by Jose Luis Tallon to fix broken syslog call
 **
@@ -56,8 +44,6 @@
 **      Revision 1.1  2004/02/24 15:13:21  dgm
 **      Initial revision
 **
-**
-**
 */
 
 #define _REENTRANT
@@ -90,11 +76,11 @@ static int Populate_Select_Cache( ITD_Struct *, ISC_Struct *, char *, char *, un
  * Function:     Handle_Select_Command
  *
  * Purpose:      The client sent a SELECT command.  Either hit the cache,
- *               or get data from the imap server.
+ *               or get data from the IMAP server.
  *
  * Parameters:   ptr to ITD -- client transaction descriptor
  *               ptr to ITD -- server transaction descriptor
- *               ptr to ISC -- imap select cache structure
+ *               ptr to ISC -- IMAP select cache structure
  *               ptr to char -- The select command string from the client.
  *               unsigned int -- the length of the select command
  *
@@ -265,7 +251,7 @@ extern int Handle_Select_Command( ITD_Struct *Client,
  * Purpose:      Send cached SELECT server response data back to a client.
  *
  * Parameters:   ptr to ITD -- client transaction descriptor
- *               ptr to ISC -- imap select cache structure
+ *               ptr to ISC -- IMAP select cache structure
  *               ptr to char -- client tag for response
  *
  * Returns:      0 on success
@@ -342,7 +328,7 @@ static int Populate_Select_Cache( ITD_Struct *Server,
     
     if ( rc == -1 )
     {
-	syslog( LOG_ERR, "%s: Unable to send SELECT command to imap server so can't populate cache.", fn );
+	syslog( LOG_ERR, "%s: Unable to send SELECT command to IMAP server so can't populate cache.", fn );
 	return( -1 );
     }
 
@@ -369,7 +355,7 @@ static int Populate_Select_Cache( ITD_Struct *Server,
 	
 	if ( ( rc == -1 ) || ( rc == 0 ) )
 	{
-	    syslog( LOG_WARNING, "%s: Unable to read SELECT response from imap server so can't populate cache.", fn );
+	    syslog( LOG_WARNING, "%s: Unable to read SELECT response from IMAP server so can't populate cache.", fn );
 	    return( -1 );
 	}
 	
@@ -510,7 +496,7 @@ extern unsigned int Is_Safe_Command( char *Command )
  *
  * Purpose:      Reset the cache time so the entry will not be valid
  *
- * Parameters:   ptr to ISC -- imap select cache structure
+ * Parameters:   ptr to ISC -- IMAP select cache structure
  *
  * Returns:      nothing
  *
diff --git a/src/threads.c b/src/threads.c
index 300a96a..b76e695 100644
--- a/src/threads.c
+++ b/src/threads.c
@@ -1,46 +1,34 @@
 /*
-** 
-**               Copyright (c) 2002-2007 Dave McMurtrie
 **
-** This file is part of imapproxy.
+** Copyright (c) 2010-     The SquirrelMail Project Team
+** Copyright (c) 2002-2010 Dave McMurtrie
 **
-** imapproxy is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** imapproxy is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with imapproxy; if not, write to the Free Software
-** Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+** Licensed under the GNU GPL. For full terms see the file COPYING.
 **
+** This file is part of SquirrelMail IMAP Proxy.
 **
 **  Facility:
 **
-**    threads.c
+**      threads.c
 **
 **  Abstract:
 **
-**    Routines to provide threadsafe interaction with OpenSSL libraries.
+**      Routines to provide threadsafe interaction with OpenSSL libraries.
 **
 **  Authors:
 **
-**    Jan Grant, based on http://www.openssl.org/docs/crypto/threads.html
+**      Dave McMurtrie <davemcmurtrie@hotmail.com>
 **
-**  RCS:
+**  Version:
 **
-**    $Source: /afs/andrew.cmu.edu/usr18/dave64/work/IMAP_Proxy/src/RCS/threads.c,v $
-**    $Id: threads.c,v 1.2 2007/05/31 11:58:17 dave64 Exp $
+**      $Id$
 **
 **  Modification History:
 **
-**    $Log: threads.c,v $
-**    Revision 1.2  2007/05/31 11:58:17  dave64
-**    Added license information and updated comment block.
+**      $Log$
+**
+**      Revision 1.2  2007/05/31 11:58:17  dave64
+**      Added license information and updated comment block.
 **
 **
 */
-- 
2.7.4

